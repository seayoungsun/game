# API 概览（认证 · 房间 · 流程）

> 本文为高层概述，帮助前端/测试快速理解用户侧 API 的边界与使用方式。详细参数、字段与示例以代码实现为准。

---

## 基本信息
- **基础URL**：`http://localhost:8080/api/v1`
- **认证方式**：JWT（在需要认证的请求中携带 Header）
  - `Authorization: Bearer <token>`
- **实时通信**：WebSocket（游戏房间广播与状态推送）
  - `ws://localhost:8081/ws?token=<token>`

---

## 认证与用户
- 注册与登录用于换取 JWT Token，Token 有有效期（可配），到期需重新登录。
- 已登录用户可获取个人资料与钱包信息；未登录访问需要认证的接口会返回未认证错误。
- 账号状态受控（启用/封禁），密码加密存储。

典型流程：
1) 注册或登录获取 Token  
2) 在后续请求 Header 中加入 `Authorization: Bearer <token>`  
3) 访问个人资料、创建/加入房间、游戏操作等需要认证的接口  

---

## 房间与游戏（HTTP）
- 房间按游戏类型与房间类型区分（示例：`texas`、`bull`、`running`；`quick`/`middle`/`high`）。
- 基本能力：创建房间、加入/离开、获取房间信息、房间列表。
- 流程控制：准备/取消准备、开始游戏、游戏内动作（如出牌/过牌）、获取游戏状态。
- 约束：游戏中不可加入/离开；开始游戏通常要求全部玩家已准备且人数达标。

典型流程：
1) 创建或加入房间  
2) 玩家准备 → 创建者开始游戏  
3) 游戏进行中按规则出牌/过牌  
4) 结束后可查看房间状态或历史记录  

---

## 实时通信（WebSocket）
- 用于房间内广播与状态变更推送（玩家加入/离开、准备状态、出牌结果、回合推进等）。
- 客户端建立连接后可订阅房间，并根据推送刷新前端 UI。
- 心跳机制保持长连；异常会推送错误消息。

基本要点：
- 连接：`ws://localhost:8081/ws?token=<token>`  
- 消息体包含 `type`、可选的 `room_id` 与 `data` 字段  
- 重要事件：连接成功、加入/离开房间、房间状态更新、心跳 ping/pong、错误通知  

---

## 错误与健壮性
- 统一响应结构：`code` + `message` + 可选 `data`
- 常见错误：参数错误（400）、未认证（401）、资源不存在（404）、服务器错误（500）
- 认证失败或缺失 Token 时，服务直接返回未认证错误
- 游戏规则与状态机会在服务端校验，非法操作返回业务错误信息

---

## 环境与配置
- 端口、Token 过期时间、跨域等在后端配置中可调
- 前端需配置 API 基础地址与 WebSocket 地址（开发/生产环境区分）

---

## 快速联调建议
1) 先打通登录换 Token  
2) 调通创建/加入房间与获取房间信息  
3) 建立 WebSocket 连接，观察 `room_updated` 推送  
4) 在多客户端下验证准备/开始游戏/出牌等关键链路  


